#!/bin/bash
echo "Checking for open TCP ports..."
nmap $1 -p- --open -T4 -Pn --max-retries=1 > /tmp/open-ports.txt
ports=`grep open /tmp/open-ports.txt | cut -d'/' -f1 | sed ':a;N;$!ba;s/\n/\,/g'`
if [ "$ports" == "" ];then
    echo "No ports found"
    exit
else
    echo "The following ports are open: "
    echo $ports
    sleep 2
    echo "Trying to identify services running on each and scanning with default and vuln scripts."
    nmap $1 -p $ports -T4 --max-retries=1 -sS -A -oN deep_scan-$1.nmap -Pn
fi

echo "Checking for open UDP ports..."
nmap -Pn -sU $1 -p U:7,11,13,19,37,53,69,123,137,138,161,177,285,500,523,1433,1434,1801,2512,2513,2598,2897,3527,5465 --open -T4 --max-retries=1 > /tmp/open-ports.txt
ports=`grep open /tmp/open-ports.txt | cut -d'/' -f1 | sed ':a;N;$!ba;s/\n/\,/g'`
if [ "$ports" == "" ];then
    echo "No ports found"
    exit
else
	echo "The following ports are open: "
	echo $ports
	sleep 2
	echo "Trying to identify services running on each and scanning with default scripts."
	nmap $1 -sU -p U:$ports -oN udp_scan.nmap -T4 --max-retries=1 -Pn --open
fi
