#!/bin/bash

logfile="web-app-scan.log"
touch $logfile

# Function to log and display messages
log_message() {
    echo -e "\n=============== +$1+ ===============\n" | tee -a $logfile
}

# Function to check and install dependencies
check_install() {
    command -v $1 &> /dev/null
    if [ $? -ne 0 ]; then
        log_message "Installing $1..."
        if [ "$1" == "python3" ]; then
            sudo apt update && sudo apt install -y python3
        elif [ "$1" == "pip3" ]; then
            sudo apt update && sudo apt install -y python3-pip
        elif [ "$1" == "wafw00f" ]; then
            pip3 install wafw00f
        elif [ "$1" == "gobuster" ]; then
            sudo apt install -y gobuster
        elif [ "$1" == "sublist3r" ]; then
            pip3 install sublist3r
        elif [ "$1" == "whatweb" ]; then
            sudo apt install -y whatweb
        elif [ "$1" == "nmap" ]; then
            sudo apt install -y nmap
        elif [ "$1" == "nikto" ]; then
            sudo apt install -y nikto
        elif [ "$1" == "curl" ]; then
            sudo apt install -y curl
        elif [ "$1" == "dig" ]; then
            sudo apt install -y dnsutils
        elif [ "$1" == "openssl" ]; then
            sudo apt install -y openssl
        else
            log_message "Unknown tool: $1"
        fi
    fi
}

# Check and install dependencies
check_install python3
check_install pip3
check_install wafw00f
check_install gobuster
check_install sublist3r
check_install whatweb
check_install nmap
check_install nikto
check_install curl
check_install dig
check_install openssl

read -p 'What is the target domain?: ' targ

log_message "Pinging Host"
ping -c 3 $targ | tee -a $logfile

log_message "Checking Host DNS Records"
dig $targ +answer +nocomments +nostats | tee -a $logfile

log_message "Detecting Web Application Firewall (WAF)"
wafw00f -a $targ | tee wafw00f.log
cat wafw00f.log >> $logfile

log_message "Running Nmap Aggressive Port Scan with HTTP(S) Scripts"
nmap $targ -p80,443 -A -Pn --script="http-*" -oN port_scan.nmap
cat port_scan.nmap >> $logfile

log_message "Fetching SSL/TLS Certificate Information"
echo | openssl s_client -connect $targ:443 2>/dev/null | openssl x509 -noout -text | tee -a $logfile

log_message "Fetching HTTP Headers"
curl -I https://$targ | tee -a $logfile

log_message "Running Nikto Scan"
nikto -maxtime 30s -host $targ | tee nikto.log
cat nikto.log >> $logfile

log_message "Running Directory Brute Force with Gobuster"
gobuster dir -u https://$targ -w /usr/share/wordlists/dirb/common.txt -t 50 | tee gobuster.log
cat gobuster.log >> $logfile

log_message "Subdomain Enumeration with Sublist3r"
sublist3r -d $targ -o subdomains.txt
cat subdomains.txt | tee -a $logfile

log_message "Web Application Fingerprinting with WhatWeb"
whatweb $targ | tee whatweb.log
cat whatweb.log >> $logfile

echo "Scan complete. Results saved to $logfile."
